<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        div {
            width: 400px;
            height: 500px;
            margin: 0 auto;
        }

        div span {
            width: 10%;
        }

        div input {
            width: 50%;
        }

        #submit {
            width: 100%;
            height: 50px;
        }

        p {
            height: 20px;
            margin: 0 0 20px 65px;
        }

        .current {
            display: block;
            color: green;
        }

        .error {
            display: block;
            color: red;
        }
    </style>
</head>

<body>
    <div class="content">
        <span>手机号：</span><input type="text" name="" id="phonenumber"><button id="getCode">获取验证码</button><br>
        <p></p>
        <span>验证码：</span><input type="text" name="" id="security"><br>
        <button id="submit">进行验证</button>
        </<span>

        <script src="./jquery-1.12.4.js"></script>
        <script>
            $('#phonenumber').on('input', function () {
                var number = $(this).val();
                if (!/^1(3|4|5|6|7|8|9)\d{9}$/.test(number)) {
                    $('p').text('格式错误！！！').addClass('error');
                    $('p').removeClass('current');
                } else {
                    $('p').text('格式正确！！！').addClass('current');
                    $('p').removeClass('error');
                }
            })

            var time;
            var that;
            // 点击获取验证码
            $('#getCode').click(function () {
                if (!$('#phonenumber').val().trim()) {
                    alert('请输入手机号！！！');
                    return;
                }

                $.ajax({
                    url: '/getmsg',
                    data: {
                        phonenumber: $('#phonenumber').val().trim()
                    },
                    success: (res) => {
                        if (res.code === 200) {
                            $(this).attr('disabled', true).text("60秒后可重新获取");
                            time = 60;
                            that = this;
                            setTimeout(function () {
                                time--;
                                if (time >= 0) {
                                    $(that).text(time + "秒后可重新获取");
                                    setTimeout(arguments.callee, 1000);
                                } else {
                                    $(that).attr('disabled', false).text("获取验证码");
                                }
                            }, 1000);
                        } else {
                            alert(res.msg);
                        }
                    }
                })
            })

            $('#submit').click(function () {
                if (!$('#security').val().trim() || !$('#phonenumber').val().trim()) {
                    alert('请输入验证码！！');
                    return;
                }
                $.ajax({
                    type: 'post',
                    url: '/getaccess',
                    data: {
                        phone: $('#phonenumber').val().trim(),
                        code: $('#security').val().trim() * 1,
                    }
                });
            })
        </script>
</body>

</html>